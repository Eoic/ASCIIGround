<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASCIIGround demo</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Courier New', monospace;
            background: #000;
            color: #00ff00;
            overflow: hidden;
        }

        .controls {
            position: fixed;
            top: 20px;
            left: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.9);
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #00ff00;
            backdrop-filter: blur(5px);
        }

        .controls h2 {
            margin-top: 0;
            color: #00ff00;
            font-size: 1.2rem;
        }

        .controls button {
            background: #000;
            color: #00ff00;
            border: 1px solid #00ff00;
            padding: 8px 16px;
            margin: 4px;
            cursor: pointer;
            font-family: 'Courier New', monospace;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .controls button:hover {
            background: #00ff00;
            color: #000;
            box-shadow: 0 0 10px #00ff00;
        }

        .controls button.active {
            background: #00ff00;
            color: #000;
        }

        .info {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #00ff00;
            max-width: 300px;
            backdrop-filter: blur(5px);
        }

        .info h3 {
            margin-top: 0;
            color: #00ff00;
            font-size: 1rem;
        }

        .info p {
            margin: 5px 0;
            font-size: 0.9rem;
        }

        .header {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            text-align: right;
            background: rgba(0, 0, 0, 0.9);
            padding: 15px;
            border-radius: 8px;
            border: 1px solid #00ff00;
            backdrop-filter: blur(5px);
        }

        .header h1 {
            margin: 0;
            color: #00ff00;
            font-size: 1.5rem;
        }

        .header p {
            margin: 5px 0 0 0;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        canvas {
            display: block;
        }

        .loading {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: #00ff00;
            font-size: 1.2rem;
            z-index: 2000;
        }
    </style>
</head>

<body>
    <div class="loading" id="loading">Loading ASCIIGround...</div>

    <div class="header">
        <h1>ASCIIGround</h1>
        <p>Live demo from CDN</p>
    </div>

    <div class="controls" style="display: none;" id="controls">
        <h2>Controls</h2>
        <div>
            <button onclick="setPattern('perlin')" id="btn-perlin">Perlin Noise</button>
            <button onclick="setPattern('wave')" id="btn-wave">Waves</button>
            <button onclick="setPattern('rain')" id="btn-rain">Rain</button>
            <button onclick="setPattern('static')" id="btn-static">Static</button>
        </div>
        <div style="margin-top: 10px;">
            <button onclick="toggleAnimation()" id="btn-toggle">Toggle Animation</button>
            <button onclick="changeSpeed()" id="btn-speed">Change Speed</button>
        </div>
    </div>

    <div class="info" style="display: none;" id="info">
        <h3>Current Settings</h3>
        <p>Pattern: <span id="current-pattern">perlin</span></p>
        <p>Speed: <span id="current-speed">0.01</span></p>
        <p>Characters: <span id="current-chars">8</span></p>
        <p>FPS: <span id="current-fps">~60</span></p>
    </div>

    <canvas id="background-canvas"></canvas>

    <script src="https://unpkg.com/asciiground@latest/dist/asciiground.umd.js"></script>
    <script>
        let currentBackground;
        let currentSpeed = 0.01;
        let isAnimating = true;
        let currentPatternName = 'perlin';

        const patterns = {
            perlin: [' ', '.', ':', ';', '+', '*', '#', '@'],
            wave: ['~', '-', '=', '#', '▓', '█'],
            rain: ['|', '!', '1', ':', '.', ' '],
            static: [' ', '.', '*', '#', '▓', '█']
        };

        function initBackground() {
            const canvas = document.getElementById('background-canvas');
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;

            try {
                currentBackground = new ASCIIGround.default(canvas, {
                    pattern: 'perlin',
                    characters: patterns.perlin,
                    speed: currentSpeed,
                    fontSize: 12,
                    color: '#00ff00',
                    backgroundColor: '#000000'
                });

                currentBackground.start();
                updateInfo();

                // Show controls and info after successful initialization
                document.getElementById('loading').style.display = 'none';
                document.getElementById('controls').style.display = 'block';
                document.getElementById('info').style.display = 'block';

                // Set initial active button
                updateActiveButton();

            } catch (error) {
                console.error('Failed to initialize ASCIIGround:', error);
                document.getElementById('loading').textContent = 'Failed to load ASCIIGround library';
            }
        }

        function setPattern(pattern) {
            if (currentBackground && patterns[pattern]) {
                currentPatternName = pattern;
                currentBackground.updateOptions({
                    pattern: pattern,
                    characters: patterns[pattern]
                });
                updateInfo();
                updateActiveButton();
            }
        }

        function toggleAnimation() {
            if (currentBackground) {
                if (isAnimating) {
                    currentBackground.stop();
                } else {
                    currentBackground.start();
                }
                isAnimating = !isAnimating;
                document.getElementById('btn-toggle').textContent = isAnimating ? 'Stop Animation' : 'Start Animation';
            }
        }

        function changeSpeed() {
            const speeds = [0.005, 0.01, 0.02, 0.05, 0.1];
            const currentIndex = speeds.indexOf(currentSpeed);
            const nextIndex = (currentIndex + 1) % speeds.length;
            currentSpeed = speeds[nextIndex];

            if (currentBackground) {
                currentBackground.updateOptions({ speed: currentSpeed });
                updateInfo();
            }
        }

        function updateInfo() {
            const chars = currentBackground?.options?.characters?.length || 8;

            document.getElementById('current-pattern').textContent = currentPatternName;
            document.getElementById('current-speed').textContent = currentSpeed;
            document.getElementById('current-chars').textContent = chars;
        }

        function updateActiveButton() {
            // Remove active class from all pattern buttons
            ['perlin', 'wave', 'rain', 'static'].forEach(pattern => {
                document.getElementById(`btn-${pattern}`).classList.remove('active');
            });

            // Add active class to current pattern button
            document.getElementById(`btn-${currentPatternName}`).classList.add('active');
        }

        // Handle window resize
        window.addEventListener('resize', () => {
            if (currentBackground) {
                const canvas = document.getElementById('background-canvas');
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                currentBackground.resize(canvas.width, canvas.height);
            }
        });

        // Handle keyboard shortcuts
        document.addEventListener('keydown', (event) => {
            switch (event.key) {
                case '1': setPattern('perlin'); break;
                case '2': setPattern('wave'); break;
                case '3': setPattern('rain'); break;
                case '4': setPattern('static'); break;
                case ' ':
                    event.preventDefault();
                    toggleAnimation();
                    break;
                case 's':
                case 'S':
                    changeSpeed();
                    break;
            }
        });

        window.addEventListener('load', () => {
            setTimeout(initBackground, 100);
        });

        if (typeof ASCIIGround !== 'undefined') {
            initBackground();
        }
    </script>
</body>

</html>